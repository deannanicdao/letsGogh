<h3>
  <strong>Title:</strong>
  <%= @item.title %>
</h3>
<table class="table">
    <tr>
        <p>
          <strong>Description:</strong>
          <%= @item.description %>
        </p>

        <p>
          <strong>Price:</strong>
          <%= @item.price %>
        </p>

        <p>
          <strong>Category:</strong>
          <%= @item.category %>
        </p>

        <p>
          <strong>Availability:</strong>
          <%= @item.availability %>
        </p>

        <p>
          <strong>User:</strong>
          <%= @item.user.email %>
        </p>
      </tr>
      <tr>
        <p>
          <%= image_tag @item.image, class: "item-image" %>
        </p>
      </tr>


      <% if can? :manage, @item %>
        <%= link_to 'Edit', edit_item_path(@item) %> |
      <% end %>
      <p><button id="buynow-button">Purchase</button></p>
      
      <script src="https://js.stripe.com/v3/"></script>

      <script>
          const stripe = Stripe('<%= ENV["STRIPE_PUBLISHABLE_KEY"] %>')
          const buyButton = document.getElementById('buynow-button')

          buyButton.addEventListener('click', function(){
              // console.log(stripe)
              fetch('<%= buy_path(@item.id) %>', { 
                  method: 'POST' 
              })
              .then(function(response) {
                  return response.json()
              })
              .then(function(session) {
                  return stripe.redirectToCheckout({ sessionId: session.id })
              })
          })
      </script>
      <%= link_to 'Back', items_path %> |
</table>
